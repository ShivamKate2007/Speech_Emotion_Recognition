<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SER Web App</title>
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
  />
  <style>
    /* ---------- GLOBAL STYLES ---------- */
    :root {
      --transition-speed: 0.3s;
      --light-bg: #f0f4f8;
      --dark-bg: #121212;
      --light-container: #ffffff;
      --dark-container: #1e1e1e;
      --light-text: #333;
      --dark-text: #fff;
      --accent-color: #007bff;
      --danger-color: #dc3545;
      --light-muted: #6c757d;
      --dark-muted: #bbb;
      --wave-light: #e0f2ff;
      --wave-dark: #1a1a1a;
    }

    body {
      font-family: "Poppins", sans-serif;
      margin: 0;
      padding: 0;
      background: var(--light-bg);
      color: var(--light-text);
      transition: background var(--transition-speed), color var(--transition-speed);
      overflow-x: hidden;
    }

    /* Wave background */
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 200%;
      height: 200%;
      background: url("https://cdn.jsdelivr.net/gh/lironHazan/wavey/wavey-light.svg") no-repeat center/cover;
      opacity: 0.25;
      pointer-events: none;
      transition: opacity var(--transition-speed), background var(--transition-speed);
    }

    .dark-mode::before {
      background: url("https://cdn.jsdelivr.net/gh/lironHazan/wavey/wavey-dark.svg") no-repeat center/cover;
      opacity: 0.2;
    }

    /* ---------- CONTAINER ---------- */
    .container {
      max-width: 600px;
      background: var(--light-container);
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      margin-top: 70px;
      position: relative;
      z-index: 1;
      transition: background var(--transition-speed), box-shadow var(--transition-speed);
    }

    /* ---------- THEME TOGGLE ---------- */
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      font-size: 24px;
      cursor: pointer;
      color: var(--accent-color);
      transition: transform var(--transition-speed);
      z-index: 2;
    }
    .theme-toggle:hover {
      transform: rotate(20deg);
    }

    /* ---------- BUTTONS ---------- */
    .btn {
      border-radius: 8px;
      font-size: 16px;
      padding: 10px 16px;
      transition: transform var(--transition-speed);
    }
    .btn:hover {
      transform: scale(1.05);
    }
    .btn-primary {
      background-color: var(--accent-color);
      border: none;
    }
    .btn-danger {
      background-color: var(--danger-color);
      border: none;
    }

    /* ---------- RESULTS CONTAINER ---------- */
    .results-container {
      background: #e9ecef;
      padding: 15px;
      border-radius: 10px;
      margin-top: 15px;
      text-align: center;
      transition: background var(--transition-speed);
    }

    /* ---------- LOADER ---------- */
    .loader {
      display: none;
      font-size: 20px;
      color: var(--accent-color);
    }

    /* ---------- DARK MODE OVERRIDES ---------- */
    .dark-mode {
      background-color: var(--dark-bg);
      color: var(--dark-text);
    }
    .dark-mode .container {
      background: var(--dark-container);
      box-shadow: 0 4px 12px rgba(255, 255, 255, 0.1);
    }
    .dark-mode .results-container {
      background: #282828;
    }
    .dark-mode .theme-toggle {
      color: #ffd700;
    }
    .dark-mode body::before {
      opacity: 0.2;
    }
    .dark-mode .text-muted {
      color: var(--dark-muted) !important;
    }

    /* ---------- PROJECT CREDITS (VISIBLE IN DARK MODE) ---------- */
    .project-info {
      background: rgba(255, 255, 255, 0.2);
      padding: 12px;
      text-align: center;
      border-radius: 8px;
      margin-top: 40px;
      font-weight: 500;
      color: #222;
      transition: background 0.3s, color 0.3s;
    }

    .dark-mode .project-info {
      background: rgba(0, 0, 0, 0.6);
      color: #ffffff !important;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .project-info h5 {
      margin: 0;
      font-size: 16px;
      color: #007bff;
    }

    .copyright {
      text-align: center;
      font-size: 13px;
      color: #444;
      margin-top: 5px;
      transition: color 0.3s;
    }

    .dark-mode .copyright {
      color: #ddd !important;
    }
  </style>
</head>
<body>
  <!-- Theme Toggle Icon -->
  <i class="fa-solid fa-moon theme-toggle" id="theme-toggle"></i>

  <div class="container text-center">
    <h2 class="mt-3"><i class="fa-solid fa-microphone-lines"></i> Speech Emotion Recognition</h2>
    <p class="text-muted">Upload an audio file or record live to detect emotion and transcribe speech.</p>

    <!-- Upload Section -->
    <form id="upload-form" enctype="multipart/form-data" class="mb-3">
      <div class="mb-3">
        <input
          type="file"
          name="file"
          accept="audio/*"
          class="form-control"
          required
        />
      </div>
      <button type="submit" class="btn btn-primary">
        <i class="fa-solid fa-upload"></i> Upload & Detect Emotion
      </button>
    </form>

    <hr />

    <!-- Recording Section -->
    <h5>Or Record Audio</h5>
    <button id="record-btn" class="btn btn-danger">
      <i class="fa-solid fa-microphone"></i> Start Recording
    </button>
    <p id="recording-status" class="recording mt-2"></p>

    <!-- Loader (Processing) -->
    <p id="loading" class="loader mt-2">
      <i class="fa-solid fa-spinner fa-spin"></i> Processing...
    </p>

    <!-- Results Display -->
    <div class="results-container">
      <h4>Detected Emotion: <span id="detected-emotion" class="text-success">Waiting...</span></h4>
      <h4>Transcription: <span id="transcription" class="text-primary">Waiting...</span></h4>
    </div>
  </div>
    <!-- Project Credits & Copyright -->
    <div class="project-info">
        <h5>üé§ Project Created By:</h5>
        <p>Shivam Kate ‚Ä¢ Om Gopale ‚Ä¢ Aditya Argade ‚Ä¢ Parth Pande</p>
        <p class="small-text">Batch: F.Y AD1 | 2024-28</p>
    </div>
    <p class="copyright">¬© 2025 Speech Emotion Recognition. All Rights Reserved.</p>
  
  <!-- JavaScript for File Upload & Recording -->
  <script>
    let mediaRecorder;
    let audioChunks = [];

    function updateResults(emotion, transcription) {
      document.getElementById("detected-emotion").innerText = emotion || "Unknown";
      document.getElementById("transcription").innerText = transcription || "No transcription";
    }

    function toggleLoader(show) {
      document.getElementById("loading").style.display = show ? "block" : "none";
    }

    document.getElementById("upload-form").addEventListener("submit", async function(event) {
      event.preventDefault();
      const formData = new FormData(this);

      toggleLoader(true);
      updateResults("Processing...", "Processing...");

      try {
        const response = await fetch("/upload", { method: "POST", body: formData });
        const result = await response.json();
        console.log("Server Response:", result);

        if (result.error) {
          updateResults("Error", result.error);
        } else {
          updateResults(result.emotion, result.transcription);
        }
      } catch (error) {
        updateResults("Error", error.message);
      } finally {
        toggleLoader(false);
      }
    });

    document.getElementById("record-btn").addEventListener("click", async function() {
      const recordButton = this;
      if (recordButton.innerText.includes("Start Recording")) {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];

        mediaRecorder.ondataavailable = event => audioChunks.push(event.data);
        mediaRecorder.onstop = async () => {
          const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
          const audioFile = new File([audioBlob], "recorded_audio.wav", { type: "audio/wav" });

          const formData = new FormData();
          formData.append("audio", audioFile);

          toggleLoader(true);
          updateResults("Processing...", "Processing...");

          try {
            const response = await fetch("/record", { method: "POST", body: formData });
            const result = await response.json();
            console.log("üîç Server Response:", result);

            if (result.error) {
              updateResults("Error", result.error);
            } else {
              updateResults(result.emotion, result.transcription);
            }
          } catch (error) {
            updateResults("Error", error.message);
          } finally {
            toggleLoader(false);
          }
        };

        mediaRecorder.start();
        recordButton.innerHTML = '<i class="fa-solid fa-stop"></i> Stop Recording';
        document.getElementById("recording-status").innerText = "Recording...";

        setTimeout(() => {
          mediaRecorder.stop();
          recordButton.innerHTML = '<i class="fa-solid fa-microphone"></i> Start Recording';
        }, 5000);
      }
    });

    // Theme Toggle (Dark/Light)
    const themeToggle = document.getElementById("theme-toggle");
    themeToggle.addEventListener("click", function () {
      document.body.classList.toggle("dark-mode");

      // Switch icon from moon <-> sun
      if (document.body.classList.contains("dark-mode")) {
        themeToggle.classList.remove("fa-moon");
        themeToggle.classList.add("fa-sun");
      } else {
        themeToggle.classList.remove("fa-sun");
        themeToggle.classList.add("fa-moon");
      }
    });
  </script>
</body>
</html>
